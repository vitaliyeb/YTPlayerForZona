<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <!--    <link rel="stylesheet" href="./style.css">-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
            color: #ddd;
            font-size: 12px;
            font-family: 'Roboto', sans-serif;
            font-weight: 500;
            text-shadow: 0 0 2px rgba(0, 0, 0, 0.50);
        }

        body {
            overflow: hidden;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }


        .player__wrapper {
            display: inline-flex;
            position: relative;
            overflow: hidden;
        }

        .action__panel {
            bottom: 0;
            position: absolute;
            width: 100%;
            display: flex;
            align-items: center;
            padding: 0 17px;
            transition-duration: .3s;
            height: 41px;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .action__panel[data-status="open"] {
            bottom: 0;
        }

        .action__panel[data-status="close"] {
            bottom: -50px;
        }

        .panel__gradient {
            background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAACSCAYAAACE56BkAAAAAXNSR0IArs4c6QAAAPVJREFUKFNlyOlHGAAcxvHuY93H1n1fW1v3fbej+zAmI5PIRGYiM5JEEkkiiSSRRPoj83nze9Pz4uPrSUh4tURPEpKDFJWKtCBdZSAzeKOykB3kqFzkBfmqAIVBkSrGW7wLSlQpyoJyVYHKoEpVoyaoVXWoDxpUI5qCZtWC98EH1YqPwSfVhvagQ3WiK+hWPegN+lQ/BoJBNYRhjASjagzjwYSaxOfgi/qKb8GUmsZMMKvmMB8sqEUsYRnf8QMr+IlV/MIa1rGB39jEFv7gL7axg3/4j13sYR8HOMQRjnGCU5zhHBe4xBWucYNb3OEeD3jEE55fAOe7I9q0+rDDAAAAAElFTkSuQmCC");
            height: 164px;
            position: absolute;
            width: 100%;
            left: 0;
            bottom: 0;
            background-position: bottom;
            background-repeat-y: no-repeat;
        }

        .action__panel > div:not(.panel__gradient) {
            z-index: 2;
        }

        .panel__progress {
            height: 3px;
            left: 12px;
            width: calc(100vw - 24px);
            background-color: rgba(255, 255, 255, 0.45);
            position: absolute;
            top: 0;
        }

        .progress__ball {
            width: 20px;
            height: 20px;
            background-color: #f00;
            border-radius: 50%;
            transform: translate(-50%, -50%) scale(.6);
            top: 50%;
            left: 0;
            position: absolute;
            cursor: pointer;
        }

        .panel__player-status {
            display: flex;
            cursor: pointer;
        }

        .panel__player-status[data-status="play"] #play {
            display: none;
        }

        .panel__player-status[data-status="pause"] #pause {
            display: none;
        }

        .panel__volume {
            display: flex;
            align-items: center;
            padding: 0 7px;
        }

        .panel__volume[data-status="open"] .panel__volume-range {
            width: 64px;
        }


        .panel__volume-range {
            display: flex;
            align-items: center;
            overflow: hidden;
            width: 0;
        }

        .panel__volume-ball {
            width: 12px;
            height: 12px;
            background-color: #fff;
            border-radius: 50%;
            z-index: 2;
            position: relative;
            cursor: pointer;
            left: 52px;
        }

        .panel__volume-ball::after,
        .panel__volume-ball::before {
            content: "";
            position: absolute;
            z-index: -1;
            top: 50%;
            left: 50%;
            width: 64px;
            height: 3px;
        }

        .panel__volume-ball::after {
            background-color: #fff;
            transform: translate(-100%, -50%);
        }

        .panel__volume-ball::before {
            background-color: rgba(255, 255, 255, .4);
            transform: translate(0, -50%);
        }

        .panel__time {
            margin-right: auto;
        }

        .panel__toggle-screen {
            display: flex;
            cursor: pointer;
        }
    </style>
</head>
<body>
<div class="player__wrapper" id="wrapper" data-status="open">
    <div id="player"></div>
    <div class="action__panel" data-status="open" id="action-panel">
        <!--        <div class="panel__gradient"></div>-->
        <div class="panel__progress" id="progress-wrapper">
            <div class="progress__ball" id="progress-ball"></div>
        </div>
        <div class="panel__player-status" id="panel-play" data-status="pause">
            <svg id="play" fill="#fff" height="36" width="36" viewBox="0 0 36 36">
                <path class="ytp-svg-fill" d="M 12,26 18.5,22 18.5,14 12,10 z M 18.5,22 25,18 25,18 18.5,14 z"></path>
            </svg>
            <svg id="pause" fill="#fff" height="36" width="36" viewBox="0 0 36 36">
                <path class="ytp-svg-fill" d="M 12,26 16,26 16,10 12,10 z M 21,26 25,26 25,10 21,10 z"
                      id="ytp-id-161"></path>
            </svg>
        </div>
        <div class="panel__volume" id="volume-wrapper" data-status="close">
            <svg height="36" version="1.1" viewBox="0 0 36 36" width="36">
                <path class="ytp-svg-fill ytp-svg-volume-animation-speaker"
                      clip-path="url(#ytp-svg-volume-animation-mask)"
                      d="M8,21 L12,21 L17,26 L17,10 L12,15 L8,15 L8,21 Z M19,14 L19,22 C20.48,21.32 21.5,19.77 21.5,18 C21.5,16.26 20.48,14.74 19,14 ZM19,11.29 C21.89,12.15 24,14.83 24,18 C24,21.17 21.89,23.85 19,24.71 L19,26.77 C23.01,25.86 26,22.28 26,18 C26,13.72 23.01,10.14 19,9.23 L19,11.29 Z"
                      fill="#fff" id="ytp-id-14"></path>
            </svg>
            <div class="panel__volume-range" id="volume-range">
                <div class="panel__volume-ball" id="volume-ball"></div>
            </div>
        </div>
        <div class="panel__time">
            <span class="time__current" id="time-current">0:00</span>
            <span class="time__separation">/</span>
            <span class="time__duration" id="time-duration">00:00</span>
        </div>
        <div class="panel__toggle-screen" id="panel-screen">
            <svg fill="#fff" height="36px" version="1.1" viewBox="0 0 36 36" width="36px">
                <g class="ytp-fullscreen-button-corner-0">
                    <use class="ytp-svg-shadow" xlink:href="#ytp-id-6"></use>
                    <path class="ytp-svg-fill" d="m 10,16 2,0 0,-4 4,0 0,-2 L 10,10 l 0,6 0,0 z" id="ytp-id-6"></path>
                </g>
                <g class="ytp-fullscreen-button-corner-1">
                    <use class="ytp-svg-shadow" xlink:href="#ytp-id-7"></use>
                    <path class="ytp-svg-fill" d="m 20,10 0,2 4,0 0,4 2,0 L 26,10 l -6,0 0,0 z" id="ytp-id-7"></path>
                </g>
                <g class="ytp-fullscreen-button-corner-2">
                    <use class="ytp-svg-shadow" xlink:href="#ytp-id-8"></use>
                    <path class="ytp-svg-fill" d="m 24,24 -4,0 0,2 L 26,26 l 0,-6 -2,0 0,4 0,0 z" id="ytp-id-8"></path>
                </g>
                <g class="ytp-fullscreen-button-corner-3">
                    <use class="ytp-svg-shadow" xlink:href="#ytp-id-9"></use>
                    <path class="ytp-svg-fill" d="M 12,20 10,20 10,26 l 6,0 0,-2 -4,0 0,-4 0,0 z" id="ytp-id-9"></path>
                </g>
            </svg>
        </div>
    </div>
</div>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        class Player {
            constructor(videoId) {
                this.player = null;
                this.loopId = null;
                this.ui = {
                    wrapper: document.getElementById('wrapper'),
                    action_panel: document.getElementById('action-panel'),
                    play_button: document.getElementById('panel-play'),
                    volume_wrapper: document.getElementById('volume-wrapper'),
                    volume_range: document.getElementById('volume-range'),
                    volume_ball: document.getElementById('volume-ball'),
                    time_current: document.getElementById('time-current'),
                    time_duration: document.getElementById('time-duration'),
                    toggle_screen_button: document.getElementById('panel-screen'),
                    progress_wrapper: document.getElementById('progress-wrapper'),
                    progress_ball: document.getElementById('progress-ball')
                };
                this.stateIterator = 'default';
                this.control = {
                    up: () => this.controlIterator('up'),
                    right: () => this.controlIterator('right'),
                    down: () => this.controlIterator('down'),
                    left: () => this.controlIterator('left'),
                    back: () => this.controlIterator('back'),
                    ok: () => this.controlIterator('ok')
                }

                const tag = document.createElement('script');
                tag.src = 'https://www.youtube.com/iframe_api';
                document.body.append(tag);

                window.onYouTubeIframeAPIReady = () => {
                    this.player = new YT.Player('player', {
                        height: window.innerHeight,
                        width: window.innerWidth,
                        videoId,
                        playerVars: {
                            controls: 0,
                        },
                        events: {
                            onReady: () => {
                                this.setDuration();
                                this.loopId = setInterval(() => {
                                    if (!this.ui.progress_ball.hasAttribute('data-status')) {
                                        this.updateCurrentTime();
                                    }
                                    this.setVolume(this.player.getVolume());
                                }, 100)
                            },
                            onStateChange: (playerState) => {
                                switch (playerState.data) {
                                    case YT.PlayerState.PLAYING:
                                        this.ui.play_button.setAttribute('data-status', 'play');
                                        break;
                                    case YT.PlayerState.PAUSED:
                                        this.ui.play_button.setAttribute('data-status', 'pause');
                                        break;
                                }
                            }
                        },
                    });
                };
                this.initEvents();
            }

            //init
            initEvents() {
                const {ui: {volume_wrapper, volume_ball, play_button, toggle_screen_button, progress_ball}} = this;
                play_button.addEventListener('click', this.togglePlayStatus)
                volume_wrapper.addEventListener('mouseenter', this.openVolumeRange);
                volume_wrapper.addEventListener('mouseleave', this.closeVolumeRange)
                volume_ball.addEventListener('mousedown', this.downVolumeBall);
                toggle_screen_button.addEventListener('click', this.toggleFullscreen);
                progress_ball.addEventListener('mousedown', this.downProgressBall)
                window.addEventListener('resize', (event) => {
                    const {ui: {wrapper}, player} = this;
                    player.setSize(window.innerWidth, window.innerHeight)
                })

            }

            convertSecond(sec) {
                let min = Math.floor(sec / 60);
                let hour = Math.floor(min / 60);
                return `${hour ? (hour % 24 + ':') : ""}${('0' + min % 60).slice(-2)}:${('0' + sec % 60).slice(-2)}`
            }

            setState(nextState) {
                console.log()
            }

            controlIterator = (key) => {
                const {ui, stateIterator} = this;
                console.log(key)
                switch (stateIterator) {
                    case 'default':
                        switch (key) {
                            case 'up':
                                this.closePanel();
                                this.setState('open-panel');
                                break;
                            case 'down':
                                this.openPanel();
                                this.setState('open-panel');
                                break;
                        }
                        break;
                    case 'down':
                        console.log('down');
                        break;
                }

            }

            //controls

            closePanel() {
                const {ui: {action_panel}} = this;
                action_panel.setAttribute('data-status', 'close')
            }

            openPanel() {
                const {ui: {action_panel}} = this;
                action_panel.setAttribute('data-status', 'open')
            }

            togglePanel() {
                const {ui: {action_panel}} = this;
                const panelStatus = action_panel.getAttribute('data-status');
                if (panelStatus === 'open') {
                    this.closePanel();
                } else {
                    this.openPanel();
                }
            }

            exitFullscreen() {
                document.exitFullscreen();
            }

            openFullscreen() {
                const {ui: {wrapper}} = this;
                wrapper.requestFullscreen();
            }

            toggleFullscreen = () => {
                if (document.fullscreenElement) {
                    this.exitFullscreen();
                } else {
                    this.openFullscreen();
                }
            }

            updateCurrentTime() {
                const {ui: {time_current}} = this;
                time_current.textContent = this.convertSecond(Math.trunc(this.player.getCurrentTime()));
            }

            setCurrentTime(sec) {
                const {ui: {time_current}} = this;
                time_current.textContent = this.convertSecond(Math.trunc(sec));
            }

            setDuration() {
                const {ui: {time_duration}} = this;
                time_duration.textContent = this.convertSecond(Math.trunc(this.player.getDuration()));
            }

            openVolumeRange = () => {
                const {ui: {volume_wrapper}} = this;
                volume_wrapper.setAttribute('data-status', 'open')
            }

            closeVolumeRange = () => {
                const {ui: {volume_wrapper}} = this;
                volume_wrapper.setAttribute('data-status', 'close')
            }

            getSecFromXPos(x) {
                const {player, ui: {progress_wrapper}} = this;
                return (player.getDuration() / 100) * (x / (progress_wrapper.offsetWidth / 100));
            }

            downProgressBall = (e) => {
                const {ui: {progress_wrapper, progress_ball, pr}, player} = this;
                const startX = e.screenX;
                const duration = player.getDuration();
                const rect = progress_wrapper.getBoundingClientRect();
                player.i.style.pointerEvents = 'none';
                progress_ball.setAttribute('data-status', 'move');
                let time = player.getCurrentTime();

                const handleMove = (e) => {
                    const position = Math.min(Math.max(0, e.clientX - rect.x), rect.width);
                    time = this.getSecFromXPos(position);
                    this.setCurrentTime(time);
                    progress_ball.style.left = `${position}px`
                }


                window.addEventListener('mousemove', handleMove);
                window.addEventListener('mouseup', () => {
                    window.removeEventListener('mousemove', handleMove);
                    progress_ball.removeAttribute('data-status');
                    player.seekTo(time, true);
                    // this.player.stopVideo();
                    player.i.style.pointerEvents = 'auto';
                }, {once: true});
            }

            downVolumeBall = (e) => {
                const {ui: {volume_wrapper, volume_range}} = this;
                const rect = volume_range.getBoundingClientRect();
                const rangeWidth = 52;
                this.setVolume((e.clientX - rect.x - 6) / ((rangeWidth) / 100));

                const moveVolumeBall = (e) => {
                    this.setVolume((e.clientX - rect.x - 6) / ((rangeWidth) / 100))
                }

                const mouseUp = () => {
                    window.removeEventListener('mousemove', moveVolumeBall);
                    window.removeEventListener('mouseup', mouseUp);
                    volume_wrapper.addEventListener('mouseenter', this.openVolumeRange);
                    volume_wrapper.addEventListener('mouseleave', this.closeVolumeRange)
                };

                window.addEventListener('mousemove', moveVolumeBall);
                window.addEventListener("mouseup", mouseUp)
                volume_wrapper.removeEventListener('mouseenter', this.openVolumeRange);
                volume_wrapper.removeEventListener('mouseleave', this.closeVolumeRange)
            }

            setVolume(vol) {
                const {ui: {volume_ball}, player} = this;
                const volume = Math.trunc(Math.max(0, Math.min(100, vol)));
                volume_ball.style.left = `${(52 / 100) * volume}px`;
                player.setVolume(volume);
            }

            play() {
                const {ui: {play_button}, player} = this;
                play_button.setAttribute('data-status', 'play');
                player.playVideo();
            }

            pause() {
                const {ui: {play_button}, player} = this;
                play_button.setAttribute('data-status', 'pause');
                player.pauseVideo();
            }

            togglePlayStatus = () => {
                const status = this.ui.play_button.getAttribute('data-status')

                if (status === 'pause') {
                    this.play();
                } else {
                    this.pause();
                }

            }
        }

        window.p = new Player('1fueZCTYkpA');


        // window.addEventListener('keydown', (e) => {
        //     const f =({
        //         "ArrowUp": p.control.up,
        //         "ArrowRight": p.control.right,
        //         "ArrowDown": p.control.down,
        //         "ArrowLeft": p.control.left,
        //         "Enter": p.control.ok,
        //         "Backspace": p.control.back,
        //     })[e.key];
        //
        //     if (typeof f === 'function') f();
        // })
    });

</script>
</body>
</html>
